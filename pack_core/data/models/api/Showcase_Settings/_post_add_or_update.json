{
  "_": "Модель данных пост-запроса на конструирование витрины данных в cl кафка+таблица+представление+словарь",
  "__req": "POST",
  "__link": "localhost:5000/settings/showcase",
  "ключ клиента в системе (на английском)": {
    "имя витрины в системе (на английском)": {
      "_human_name": "имя витрины - понятное человеку",
      "_relation_dicts": {
        "__": "Опционально",
        "_": "Отношения к словарям. Указываем список колонок словаря columns_list, которые надо достать по ключам relation_keys",
        "полное имя словаря в системе (на английском, как при создании)": {
          "_client_name": "ключ клиента в системе к которому относится словарь(на английском). Если клиент этот, то ничего не заполняем",
          "_ignore_or_using_list": "Список колонок работает по принципу все кроме(True), Только те кто в списке (False)",
          "_columns_list": [
            "Имя колонки словаря, как при создании (если оставить пустым этот список - то будут добавлены все колонки независимо от параметра ignore_or_using_list)"
          ],
          "_relation_keys": [
            "Имя колонки витрины данных, которое является ключём для соединения со словарём (вставляется в DictGet)"
          ]
        }
      },
      "_kafka_settings_queue": {
        "_": "настройки формата сообщений кафки, преобразуемых в кликхаус",
        "__": "https://clickhouse.tech/docs/ru/engines/table-engines/integrations/kafka/#table_engine-kafka-creating-a-table",
        "_Важные моменты": [
          "_Брокеры уже настроены и выбираются автоматически. Система предполагает один кластер кафки",
          "_Имя топика генерируется автоматически с использованием ключа клиента и имени витрины данных",
          "_Тоесть концепцию чтения много топиков от разных кафок применить не получиться - архитектурное ограничение",
          "_Кластер кликхауса пока не поддерживается, но планируется автоматически создавать распределённые таблицы",
          "_Количество консумеров для топика вы выбираете сами. Выделять под них отдельные потоки или нет тоже",
          "_Когда будет кластер - будет по одному консумеру на разных тачках, состоящих в одной группе, равных количеству партиций",
          "_Формат сообщения задаёте сами (по дефолту JSONEachRow)"
        ],
        "_kafka_num_consumers": "ОБЯЗАТЕЛЬНО! число потребителей - оно будет равно количеству партиций в создаваемом топике",
        "_kafka_thread_per_consumer": "0 - не выделять ядра ЦПУ/ 1 - выделять ядра ЦПУ под каждого консумера",
        "_kafka_format": "формат https://clickhouse.tech/docs/ru/interfaces/formats/",
        "_kafka_row_delimiter": "Разделитель строк, иногда надо явно его указать как \n",
        "_kafka_schema": "схема формата - для определённых форматов",
        "_kafka_max_block_size": "максимальный размер пачек (в сообщениях) для poll"
      },
      "_columns": {
        "_": "Колонки витрины данных. Синтаксис кликхауса. Как в CRUD-запросах",
        "Имя колонки на английском (column_name1 example)": {
          "_human_name": "string",
          "_type": "string (CLICK HOUSE TYPE)",
          "_new_name": "string (OPTIONAL - для случаев если надо задать новое имя колонки)",
          "_dma": "string (OPTIONAL DEFAULT|MATERIALIZED|ALIAS - выражение для вычисления колонки)",
          "_ttl": "string (OPTIONAL TTL - выражение тайм ту лайф)"
        }
      },
      "_index": {
        "__": "Опционально",
        "_": "INDEX index_name1 expr1 TYPE type1(...) GRANULARITY value1",
        "Имя индекса на английском (index_name1 example)": {
          "_expr": "выражение индекса (expr1)",
          "_type": "выражение типа индекса type1(...)",
          "_gran": "количество гранул"
        }
      },
      "engine": "движок таблицы (MergeTree() любой другой )",
      "order_by": [
        "ОБЯЗАТЕЛЕН в большинстве движков",
        "string (order by column name or expr)"
      ],
      "partition_by": [
        "Опционально",
        "string (partition by column name or expr)"
      ],
      "primary_keys": [
        "Опционально",
        "string (primary key column name or expr)"
      ],
      "sample_by": [
        "Опционально",
        "string (sample by column name or expr)"
      ],
      "ttl": "Опционально. Список правил, определяющих длительности хранения строк",
      "settings": {
        "__": "Опционально",
        "_": "Тонкие настройки движков https://clickhouse.tech/docs/ru/engines/table-engines/mergetree-family/mergetree/#table_engine-mergetree-ttl",
        "ключ настройки": "значение настройки"
      }
    }
  }
}
